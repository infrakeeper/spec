## Context

Currently the restoration process implies taking manual action directly on the machines that want to be restored. ReaR generates an ISO image that the machine that wants to be restored must boot from.

The method recommended to restore is to connect that ISO directly to either the VMs or the bare metal servers, which prevents it from being automated. However, we can leverage the capacities of ReaR itself to automate the restores. ReaR supports doing backups directly to a PXE server. 

Openstack and in particular the controllers already use PXE/iPXE through Ironic which is how it is possible to upload the ramdisk and kernel generated by ReaR and automate the restoration.

This is very helpful, as it would allow the operator to order restorations interactively without having to do any manual work.

ReaR official repository provides a reference regarding the configuration to use PXE:
https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/conf/examples/PXE-booting-example-with-URL-style.conf

Additional configuration is required, as the ovs interfaces are not supported by ReaR. We need to configure the interface for being able to connect to the BackupNode NFS server. That is why  the NETWORKING_PREPARATION_COMMANDS parameter is used in the local.conf with a default variable set to:

tripleo_backup_and_restore_network_preparation_commands: "('ip l a br-ex type bridge' 'ip l s ens3 up' 'ip l s br-ex up' 'ip l s ens3 master br-ex' 'dhclient br-ex')"

On the other hand, PXE_RECOVER_MODE and KERNEL_CMDLINE are set by default to “unattended” so no human intervention is required.

## Process

The restoration process basically does the following steps:

  * Power off node
  * Set in maintenance the node
  * Configure node to use ramdisk with ReaR
  * Unset maintenance node
  * Rebuild node
  * Run restoration
  * Power off node
  * Restore configuration
  * Power on node

This RFE will be paired with an ansible role for automating restoration on kvm virtual machines.
